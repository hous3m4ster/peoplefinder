"use strict";

/************
 * Requires *
 ************/

var BotAPI = require("teleapiwrapper").BotAPI;
var MessageSorter = require("./message_sorter");

/*************************
 * The TelegramBot class *
 *************************/

/**
 * Class for Telegram bots
 *
 * @extends MessageSorter
 */
class TelegramBot extends MessageSorter {
	/**
	 * Creates a new bot from a bot token
	 *
	 * @param {String} botToken	Token for the bot, available from Telegram's @botFather
	 */
	constructor(botToken) {
		// Create the API wrapper. Will be available on the read-only API property of this object because of the superclasses
		let API = new BotAPI(botToken);

		// Call super constructor
		super(API);

		/**
		 * Info about the bot
		 *
		 * @private
		 */
		this._infoPromise = null;
	}

	// This is here simply to modify the documentation
	/**
	 * The bot's API. An instance of teleapiwrapper's [BotAPI]{@link https://doc.suppen.no/teleapiwrapper/BotAPI.html}
	 *
	 * @type {BotAPI}
	 * @readonly
	 */
	get API() {
		return super.API;
	}

	/**
	 * Info about the bot in the form of a promise which resolves to a [User]{@link https://core.telegram.org/bots/api#user} object
	 *
	 * @type {Promise}
	 */
	get infoPromise() {
		if (this._infoPromise === null) {
			this._infoPromise = this._API.getMe();
		}
		return this._infoPromise;
	}
}

/***********
 * Exports *
 ***********/

module.exports = TelegramBot;
